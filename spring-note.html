<!DOCTYPE html>
<html lang="zh">
<head>
          <title>Hester's Blog - Spring note</title>
        <meta charset="utf-8" />





</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">Hester's Blog <strong></strong></a></h1>
        </header><!-- /#banner -->
        <nav id="menu"><ul>
            <li><a href="/category/blog.html">blog</a></li>
            <li><a href="/category/java-note.html">Java Note</a></li>
            <li class="active"><a href="/category/note.html">note</a></li>
        </ul></nav><!-- /#menu -->
<section id="content" class="body">
  <header>
    <h2 class="entry-title">
      <a href="/spring-note.html" rel="bookmark"
         title="Permalink to Spring note">Spring note</a></h2>
 
  </header>
  <footer class="post-info">
    <time class="published" datetime="2020-06-07T14:22:00+02:00">
      日 07 六月 2020
    </time>
    <address class="vcard author">
      By           <a class="url fn" href="/author/hester.html">Hester</a>
    </address>
    <div class="category">
        Category: <a href="/category/note.html">note</a>
    </div>
  </footer><!-- /.post-info -->
  <div class="entry-content">
    <h2>Spring笔记</h2>
<p>spring: IOC容器</p>
<h3>定义信息</h3>
<p>xml配置的bean抽象到spring: <strong>BeanDefinition</strong>
读取BeanDefinition的类: <strong>BeanDefintionReader</strong>
容器的本质</p>
<div class="highlight"><pre><span></span><code><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">BeanDefinition</span><span class="o">&gt;</span> <span class="n">beanDefinitionMap</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConcurrentHashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span>
</code></pre></div>


<h3>Environment</h3>
<p>为了方便使用，在容器创建的时候会提前将系统的相关属性加载到StandardEnvironment对象中，方便后续调用</p>
<h3>实例化</h3>
<p>在堆中开辟一块空间，属性都是<strong>默认值</strong></p>
<p>实例化的方式有
- new
- 反射</p>
<div class="highlight"><pre><span></span><code><span class="c1">// 完全限定名方式</span>
<span class="n">Class</span> <span class="n">clazz</span> <span class="o">=</span> <span class="n">Class</span><span class="p">.</span><span class="na">forName</span><span class="p">(</span><span class="s">&quot;xxxxxxx&quot;</span><span class="p">);</span> 

<span class="c1">// 通过对象</span>
<span class="n">Class</span> <span class="n">clazz</span> <span class="o">=</span> <span class="n">obj</span><span class="p">.</span><span class="na">getClass</span><span class="p">();</span> 

<span class="c1">// 通过类</span>
<span class="n">Class</span> <span class="n">clazz</span> <span class="o">=</span> <span class="n">Obj</span><span class="p">.</span><span class="na">class</span><span class="p">;</span>

<span class="n">Constructor</span> <span class="n">constructor</span> <span class="o">=</span> <span class="n">clazz</span><span class="p">.</span><span class="na">getDecalaredConstructor</span><span class="p">();</span>
<span class="n">Obj</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">constructor</span><span class="p">.</span><span class="na">newInstance</span><span class="p">();</span>
</code></pre></div>


<h3>初始化</h3>
<p>给属性完成赋值操作</p>
<p>初始化分为两个操作
- 填充属性，就是赋值操作
- 调用具体的初始化方法</p>
<p><strong>BeanFactory</strong> 用于创建Bean实例, 源码中有整个SpringBean声明周期的讲解
<strong>BeanFactoryPostProcessor</strong> 可以在BeanDefinition加载完成后，Bean实例化之前进行修改</p>
<p>例如<code>org.springframework.beans.factory.config.PlaceholderConfigurerSupport</code></p>
<p><strong>BeanPostProcessor</strong> bean初始化执行init前后执行</p>
<p><img alt="SpringBean" src="img/SpringBean.png"></p>
<p>关键方法: <code>org.springframework.context.support.AbstractApplicationContext#refresh</code></p>
<ul>
<li>创建BeanFactory <code>DefaultListableBeanFactory</code></li>
<li>调用BeanFactoryPostProcessor</li>
<li>注册BeanPostProcessor</li>
<li>国际化处理 i18n</li>
<li>开始实例化</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1">// Instantiate all remaining (non-lazy-init) singletons.</span>
<span class="n">finishBeanFactoryInitialization</span><span class="p">(</span><span class="n">beanFactory</span><span class="p">);</span>
</code></pre></div>


<ul>
<li>填充属性</li>
<li>BeanPostProcessor: before</li>
<li>init</li>
<li>BeanPostProcessor: after</li>
</ul>
<p><strong>监听器</strong>, <strong>观察者模式</strong></p>
<p><strong>FactoryBean</strong>用于扩展</p>
<p>源码入口<code>org.springframework.context.support.AbstractApplicationContext#refresh</code></p>
<h3>Spring解决循环依赖</h3>
  </div><!-- /.entry-content -->
</section>
        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
                which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->
        </footer><!-- /#contentinfo -->
</body>
</html>